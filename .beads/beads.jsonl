{"id":"warelay-1bd","title":"Implement Discord send helpers","description":"Context: Need utilities to send messages (and media) with Discord constraints.\nTasks:\n- Add send.ts with helpers to chunk long text to \u003c=2k chars and send sequentially.\n- Support optional media/attachments if needed by ReplyPayload mapping.\n- Return send metadata (messageId/channelId/timestamp) for logging.\nAcceptance criteria:\n- Sending helper covers dry-run/testing hooks.\n- Handles empty/no-op replies safely without crashing.\n- Unit tests planned in discord/send.test.ts.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-28T11:06:01.321252-05:00","updated_at":"2025-11-28T11:28:53.053465-05:00","closed_at":"2025-11-28T11:28:53.053465-05:00"}
{"id":"warelay-21d","title":"Tests for Discord user-aware context and session scope","description":"Context: Cover new user identity fields and session scoping logic.\nTasks:\n- Add unit tests for toMsgContext including FromUserTag/GuildId/ChannelId/ThreadId/MentionedBot.\n- Add tests for session key selection across per-sender/per-channel/per-user-channel.\nAcceptance criteria:\n- Vitest suite passes with new cases; coverage includes new branches.\n- Existing Discord tests remain green.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-28T14:10:38.986197-05:00","updated_at":"2025-11-28T14:13:26.703958-05:00","closed_at":"2025-11-28T14:13:26.703958-05:00"}
{"id":"warelay-4cs","title":"Introduce Discord provider types","description":"Context: Discord integration needs internal types for runtime config, normalized messages, send options, and monitoring.\nTasks:\n- Create src/discord/types.ts with runtime config, normalized message shape, send options/results, monitor options.\n- Align message normalization with MsgContext expectations.\nAcceptance criteria:\n- Types compile and are imported by Discord modules without circular deps.\n- Comments/docstrings clarify intent for future maintainers.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-28T11:05:49.639938-05:00","updated_at":"2025-11-28T11:28:53.029995-05:00","closed_at":"2025-11-28T11:28:53.029995-05:00"}
{"id":"warelay-4sh","title":"Expand provider types to include Discord","description":"Context: Providers union currently web/twilio; Discord must be recognized across CLI/runtime.\nTasks:\n- Update Provider type alias to include \"discord\".\n- Ensure any switches using provider types handle the new option.\nAcceptance criteria:\n- Type allows \"discord\" without TS errors.\n- Existing providers remain unaffected.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-28T11:05:40.305766-05:00","updated_at":"2025-11-28T11:28:53.006375-05:00","closed_at":"2025-11-28T11:28:53.006375-05:00"}
{"id":"warelay-4ws","title":"Epic: Discord multi-user awareness","description":"Context: Enable the assistant to distinguish multiple users in the same Discord server/channel and scope sessions appropriately.\nGoals:\n- Expose user identity metadata to templating/commands.\n- Allow configurable session scoping for Discord (per-sender/per-channel/per-user-channel).\n- Document usage and add tests.\nAcceptance criteria:\n- Discord provider can be configured to scope sessions to user or channel; default remains current behavior.\n- Templates/commands can reference user identity fields.\n- Tests and docs updated.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-28T14:10:15.212863-05:00","updated_at":"2025-11-28T14:13:39.542952-05:00","closed_at":"2025-11-28T14:13:39.542952-05:00","dependencies":[{"issue_id":"warelay-4ws","depends_on_id":"warelay-ghy","type":"parent-child","created_at":"2025-11-28T14:10:52.55245-05:00","created_by":"daemon"},{"issue_id":"warelay-4ws","depends_on_id":"warelay-osa","type":"parent-child","created_at":"2025-11-28T14:10:57.67887-05:00","created_by":"daemon"},{"issue_id":"warelay-4ws","depends_on_id":"warelay-21d","type":"parent-child","created_at":"2025-11-28T14:11:04.585992-05:00","created_by":"daemon"},{"issue_id":"warelay-4ws","depends_on_id":"warelay-dke","type":"parent-child","created_at":"2025-11-28T14:11:13.701042-05:00","created_by":"daemon"}]}
{"id":"warelay-7ih","title":"Epic: Discord provider integration","description":"Context: Implement Discord provider alongside Twilio/Web per DISCORD.md so warelay can relay and send via Discord.\nNotes: .env already has bot token set by user; focus on code, tests, docs. Keep parity with existing auto-reply flow using getReplyFromConfig.\nAcceptance criteria:\n- Discord provider available for relay and send commands; follows existing config/runtime patterns.\n- Tests and docs updated to cover Discord usage and setup.\n- Manual validation checklist captured and runnable.","notes":"All coding/docs tasks done; Discord manual validation still open as warelay-gn6 before closing epic.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-28T11:05:27.90579-05:00","updated_at":"2025-11-28T14:13:43.918387-05:00","closed_at":"2025-11-28T14:13:43.918387-05:00","dependencies":[{"issue_id":"warelay-7ih","depends_on_id":"warelay-c6x","type":"parent-child","created_at":"2025-11-28T11:06:53.361516-05:00","created_by":"daemon"},{"issue_id":"warelay-7ih","depends_on_id":"warelay-4sh","type":"parent-child","created_at":"2025-11-28T11:06:58.275294-05:00","created_by":"daemon"},{"issue_id":"warelay-7ih","depends_on_id":"warelay-9tr","type":"parent-child","created_at":"2025-11-28T11:07:01.852626-05:00","created_by":"daemon"},{"issue_id":"warelay-7ih","depends_on_id":"warelay-4cs","type":"parent-child","created_at":"2025-11-28T11:07:05.541276-05:00","created_by":"daemon"},{"issue_id":"warelay-7ih","depends_on_id":"warelay-cyp","type":"parent-child","created_at":"2025-11-28T11:07:10.154636-05:00","created_by":"daemon"},{"issue_id":"warelay-7ih","depends_on_id":"warelay-1bd","type":"parent-child","created_at":"2025-11-28T11:07:15.072048-05:00","created_by":"daemon"},{"issue_id":"warelay-7ih","depends_on_id":"warelay-cmc","type":"parent-child","created_at":"2025-11-28T11:07:18.555107-05:00","created_by":"daemon"},{"issue_id":"warelay-7ih","depends_on_id":"warelay-me3","type":"parent-child","created_at":"2025-11-28T11:07:23.415381-05:00","created_by":"daemon"},{"issue_id":"warelay-7ih","depends_on_id":"warelay-yzg","type":"parent-child","created_at":"2025-11-28T11:07:30.020052-05:00","created_by":"daemon"},{"issue_id":"warelay-7ih","depends_on_id":"warelay-ypa","type":"parent-child","created_at":"2025-11-28T11:07:33.805218-05:00","created_by":"daemon"},{"issue_id":"warelay-7ih","depends_on_id":"warelay-jzx","type":"parent-child","created_at":"2025-11-28T11:07:39.640171-05:00","created_by":"daemon"},{"issue_id":"warelay-7ih","depends_on_id":"warelay-ahz","type":"parent-child","created_at":"2025-11-28T11:07:45.172036-05:00","created_by":"daemon"},{"issue_id":"warelay-7ih","depends_on_id":"warelay-twt","type":"parent-child","created_at":"2025-11-28T11:07:50.603691-05:00","created_by":"daemon"},{"issue_id":"warelay-7ih","depends_on_id":"warelay-gn6","type":"parent-child","created_at":"2025-11-28T11:07:57.970546-05:00","created_by":"daemon"}]}
{"id":"warelay-9tr","title":"Add Discord configuration schema","description":"Context: Warelay config needs Discord section for token, allowlists, mention behavior, thread replies.\nTasks:\n- Define DiscordConfig type with botToken, allow lists, mentionOnly, replyInThread defaults.\n- Extend WarelayConfig and Zod validation to include optional discord config.\n- Ensure env override logic accounts for bot token.\nAcceptance criteria:\n- Config parse succeeds when discord block provided.\n- Validation errors are clear for missing/invalid fields.\n- No regressions to existing config paths.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-28T11:05:45.139954-05:00","updated_at":"2025-11-28T11:28:53.018196-05:00","closed_at":"2025-11-28T11:28:53.018196-05:00"}
{"id":"warelay-ahz","title":"Add Discord provider unit tests","description":"Context: Cover Discord helpers with Vitest per plan.\nTasks:\n- Write send helper tests (chunking, limits) in src/discord/send.test.ts.\n- Write events tests for mention stripping/normalization edge cases.\n- Add client/config tests if feasible (e.g., resolveDiscordConfig defaults/env precedence).\nAcceptance criteria:\n- Tests run via pnpm test src/discord and pass.\n- Coverage includes core utility branches.\n- Document any skipped cases with TODOs.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-28T11:06:35.901851-05:00","updated_at":"2025-11-28T11:28:53.124369-05:00","closed_at":"2025-11-28T11:28:53.124369-05:00"}
{"id":"warelay-c6x","title":"Add discord.js dependency","description":"Context: Discord provider requires discord.js v14.\nTasks:\n- Add discord.js dependency via pnpm to package.json/pnpm-lock.\n- Record any required Node version notes if conflict appears.\nAcceptance criteria:\n- discord.js listed in dependencies and install succeeds.\n- No lint/build errors introduced.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-28T11:05:35.105856-05:00","updated_at":"2025-11-28T11:28:52.994325-05:00","closed_at":"2025-11-28T11:28:52.994325-05:00"}
{"id":"warelay-cmc","title":"Handle Discord message events and auto-reply","description":"Context: Wire Discord inbound messages into existing auto-reply pipeline via getReplyFromConfig.\nTasks:\n- Normalize messageCreate events: ignore bots, enforce allowlists, handle DM vs channel vs threads, mentionOnly behavior, mention stripping.\n- Convert to MsgContext and call getReplyFromConfig with typing indicator support.\n- Send replies via Discord send helper, log summary and errors clearly.\n- Provide registerDiscordHandlers to attach listeners.\nAcceptance criteria:\n- Bot replies to DMs and @mentions (when mentionOnly enabled) and respects allowlists.\n- Thread messages reply in thread when enabled; no self-replies.\n- Errors logged without crashing; typing indicator cleaned up.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-28T11:06:07.154564-05:00","updated_at":"2025-11-28T11:28:53.0653-05:00","closed_at":"2025-11-28T11:28:53.0653-05:00"}
{"id":"warelay-cyp","title":"Build Discord client and runtime config resolution","description":"Context: Need a Discord.js client setup with required intents/partials and runtime config resolved from file/env.\nTasks:\n- Implement createDiscordClient with required intents (Guilds, GuildMessages, DirectMessages, MessageContent) and partials for DM channels.\n- Add resolveDiscordConfig that merges config and env vars, applies defaults, and throws if bot token missing.\n- Provide helper to login and return bot identity (id/tag) for downstream logging.\nAcceptance criteria:\n- Client creation and login succeed with DISCORD_BOT_TOKEN set.\n- Default intents/partials documented; verbose logging available for troubleshooting.\n- Safe error when bot token not configured.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-28T11:05:56.304167-05:00","updated_at":"2025-11-28T11:28:53.041776-05:00","closed_at":"2025-11-28T11:28:53.041776-05:00"}
{"id":"warelay-dke","title":"Docs: explain Discord user-aware mode","description":"Context: Document how to use the new Discord user-aware/session-scope features.\nTasks:\n- Update README/DISCORD.md with sessionScope options and new template fields (FromUserTag, GuildId, ChannelId, ThreadId, MentionedBot).\n- Add example config snippets for per-user-channel and per-channel.\nAcceptance criteria:\n- Returning contributors can configure and prompt with user-aware fields without reading code.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-28T14:10:45.510046-05:00","updated_at":"2025-11-28T14:13:30.927915-05:00","closed_at":"2025-11-28T14:13:30.927915-05:00"}
{"id":"warelay-ghy","title":"Surface Discord user identity in MsgContext","description":"Context: Discord inbound messages should expose who is speaking to prompts/commands.\nTasks:\n- Extend toMsgContext (discord/events) to include optional FromUserTag, GuildId, ChannelId, ThreadId, MentionedBot flag.\n- Keep backward compatibility; fields are optional.\n- Update types if needed to reflect new fields.\nAcceptance criteria:\n- MsgContext carries user and channel metadata for Discord messages.\n- No breaking changes to existing providers.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-28T14:10:21.411046-05:00","updated_at":"2025-11-28T14:13:17.215018-05:00","closed_at":"2025-11-28T14:13:17.215018-05:00"}
{"id":"warelay-gn6","title":"Run Discord manual validation checklist","description":"Context: Validate end-to-end behavior after implementation.\nTasks:\n- Execute manual tests from DISCORD.md (login, DM reply, channel mention with mentionOnly, thread replies, allowlist behavior, error handling).\n- Capture results/notes in issue comments or docs.\nAcceptance criteria:\n- Manual run performed and outcomes recorded.\n- Any defects filed as follow-up issues if found.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-28T11:06:47.737875-05:00","updated_at":"2025-11-28T14:13:35.833904-05:00","closed_at":"2025-11-28T14:13:35.833904-05:00"}
{"id":"warelay-jzx","title":"Implement Discord send command support","description":"Context: warelay send should deliver messages via Discord using bot token.\nTasks:\n- Add Discord branch in src/commands/send.ts using discord.js client with minimal intents to send text/media.\n- Leverage send helper for chunking/attachments; handle dry-run and json output paths.\n- Ensure client login/logout and channel fetch validation.\nAcceptance criteria:\n- warelay send --provider discord --to \u003cchannel-id\u003e --message works with bot token from env.\n- Dry-run and JSON output behave like other providers.\n- Clear errors for invalid channel or missing token.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-28T11:06:31.000874-05:00","updated_at":"2025-11-28T11:28:53.11257-05:00","closed_at":"2025-11-28T11:28:53.11257-05:00"}
{"id":"warelay-me3","title":"Add Discord provider entrypoint for relay","description":"Context: Need monitorDiscordProvider that connects client, registers handlers, and wires into runtime shutdown.\nTasks:\n- Create src/discord/index.ts exporting monitorDiscordProvider plus re-exports for helpers.\n- Implement startup sequence: resolve config, create/login client, log identity, register handlers, handle SIGINT/SIGTERM/abort signal, keep process alive.\nAcceptance criteria:\n- warelay relay --provider discord uses monitorDiscordProvider.\n- Graceful shutdown destroys client and exits.\n- Verbose logs show config and connection state.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-28T11:06:12.236916-05:00","updated_at":"2025-11-28T11:28:53.077016-05:00","closed_at":"2025-11-28T11:28:53.077016-05:00"}
{"id":"warelay-osa","title":"Configurable Discord session scoping","description":"Context: Allow choosing how sessions are keyed for Discord so multiple users in one channel donâ€™t collide.\nTasks:\n- Add discord.sessionScope config (per-sender default; per-channel; per-user-channel combines user+channel).\n- Implement session key composition for Discord before calling getReplyFromConfig.\n- Ensure defaults preserve current behavior.\nAcceptance criteria:\n- Config controls session keying for Discord; defaults match previous behavior.\n- Sessions isolate correctly per chosen scope.\n- Clear error or fallback on invalid values.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-28T14:10:31.241356-05:00","updated_at":"2025-11-28T14:13:22.254532-05:00","closed_at":"2025-11-28T14:13:22.254532-05:00"}
{"id":"warelay-twt","title":"Document Discord provider setup and usage","description":"Context: Need docs and env template updates for Discord support.\nTasks:\n- Update README with Discord setup steps (token, intents, invite) and CLI usage examples for relay/send.\n- Add DISCORD_BOT_TOKEN to .env.example and note privileged intent requirement.\n- Add manual testing checklist to DISCORD.md or new doc section if needed.\nAcceptance criteria:\n- New users can enable Discord provider following docs without guesswork.\n- Existing docs remain accurate for Twilio/Web.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-28T11:06:42.321455-05:00","updated_at":"2025-11-28T11:28:53.136509-05:00","closed_at":"2025-11-28T11:28:53.136509-05:00"}
{"id":"warelay-ypa","title":"Add Discord environment validation helper","description":"Context: Ensure clear error when DISCORD_BOT_TOKEN missing.\nTasks:\n- Add ensureDiscordEnv (or equivalent) to env utilities.\n- Use helper where Discord provider/send require token.\nAcceptance criteria:\n- Missing token yields actionable error message.\n- No effect on other providers.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-11-28T11:06:24.871096-05:00","updated_at":"2025-11-28T11:28:53.100746-05:00","closed_at":"2025-11-28T11:28:53.100746-05:00"}
{"id":"warelay-yzg","title":"Wire Discord provider into CLI commands","description":"Context: CLI should expose Discord as provider for relay and send commands.\nTasks:\n- In src/cli/program.ts add discord option to provider flags, update help text.\n- Route relay action to monitorDiscordProvider with verbose flag handling.\n- Adjust send command options default/provider list to include discord.\nAcceptance criteria:\n- CLI help shows Discord provider options.\n- Running warelay relay --provider discord invokes Discord monitor.\n- No regression to web/twilio flows.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-28T11:06:19.550723-05:00","updated_at":"2025-11-28T11:28:53.089007-05:00","closed_at":"2025-11-28T11:28:53.089007-05:00"}
